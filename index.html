<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ç”Ÿç‰©æ°”æ³¡å›¾ç”Ÿæˆå™¨</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1600px; /* å¢åŠ æœ€å¤§å®½åº¦ */
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
            user-select: none;
        }
        
        .header h1:hover {
            color: #4dabf7;
        }
        
        .header p {
            color: #6c757d;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            flex: 1;
            min-width: 300px;
        }
        
        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
            font-size: 1.4rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }
        
        .file-upload {
            border: 2px dashed #ced4da;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f8f9fa;
        }
        
        .file-upload:hover {
            border-color: #4dabf7;
            background-color: #f0f7ff;
        }
        
        .file-upload.dragover {
            border-color: #339af0;
            background-color: #e7f5ff;
        }
        
        .file-upload i {
            font-size: 40px;
            color: #adb5bd;
            margin-bottom: 15px;
        }
        
        .file-upload p {
            margin-bottom: 10px;
            color: #6c757d;
        }
        
        .file-upload .btn {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #4dabf7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .file-upload .btn:hover {
            background-color: #339af0;
        }
        
        input[type="file"] {
            display: none;
        }
        
        select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            background-color: white;
            font-size: 1rem;
        }
        
        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: 500;
            color: #4dabf7;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-group input {
            margin-right: 10px;
            width: auto;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            margin-right: 8px;
        }
        
        .color-preview {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: #4dabf7;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #339af0;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: #51cf66;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #40c057;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .visualization-container {
            width: 100%;
            margin-top: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            overflow-x: auto; /* å…è®¸æ°´å¹³æ»šåŠ¨ */
        }
        
        #chart-container {
            width: 100%;
            min-width: 800px; /* æœ€å°å®½åº¦ */
            height: 700px; /* å¢åŠ é«˜åº¦ */
            margin-top: 20px;
        }
        
        .data-preview {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            min-width: 600px;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: center;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .instructions {
            background-color: #e7f5ff;
            border-left: 4px solid #4dabf7;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
            margin-bottom: 10px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        .sample-data {
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        
        .sample-data h4 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .status-success {
            background-color: #d3f9d8;
            color: #2b8a3e;
            border: 1px solid #b2f2bb;
        }
        
        .status-error {
            background-color: #ffe3e3;
            color: #c92a2a;
            border: 1px solid #ffc9c9;
        }
        
        .status-info {
            background-color: #e7f5ff;
            color: #1864ab;
            border: 1px solid #a5d8ff;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 15px 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .value-display {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4dabf7;
        }
        
        .value-display h4 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .value-display .formula {
            font-family: monospace;
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .log-base-selector {
            background-color: #e7f5ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #a5d8ff;
        }
        
        .log-base-selector h4 {
            margin-bottom: 10px;
            color: #1864ab;
        }
        
        .grid-cell {
            stroke: #e0e0e0;
            stroke-width: 1;
            fill: white;
        }
        
        .grid-text {
            font-size: 10px;
            fill: #333;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .bubble-text {
            font-size: 10px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: middle;
            font-weight: bold;
            pointer-events: none;
        }
        
        /* æ·»åŠ å·¥å…·æç¤ºæ ·å¼ */
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            pointer-events: none;
            z-index: 1000;
            font-size: 12px;
            max-width: 300px;
        }
        
        /* æ ·æœ¬æ•°é‡æç¤º */
        .samples-info {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
            font-size: 0.9rem;
        }
        
        /* è‡ªé€‚åº”è°ƒæ•´ */
        .adaptive-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
        }
        
        /* å¯¼å‡ºæ—¶éšè—çš„ç±» */
        .export-hidden {
            display: none !important;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal.show {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            border: none;
            border-radius: 10px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 20px 30px;
            background-color: #4dabf7;
            color: white;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: opacity 0.2s;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-body h3 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .modal-body h3:first-child {
            margin-top: 0;
        }
        
        .modal-body h4 {
            color: #495057;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .modal-body ul, .modal-body ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .modal-body li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .modal-body code {
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .modal-body pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #4dabf7;
        }
        
        .modal-body pre code {
            background-color: transparent;
            padding: 0;
        }
        
        .modal-body blockquote {
            border-left: 4px solid #4dabf7;
            padding-left: 15px;
            margin: 15px 0;
            color: #6c757d;
            font-style: italic;
        }
        
        .modal-body a {
            color: #4dabf7;
            text-decoration: none;
        }
        
        .modal-body a:hover {
            text-decoration: underline;
        }
        
        .modal-body strong {
            color: #2c3e50;
        }
        
        .download-link {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #4dabf7;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .download-link:hover {
            background-color: #339af0;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 id="title-clickable">å¾®ç”Ÿç‰©ä¸°åº¦æ°”æ³¡å›¾ç”Ÿæˆå™¨</h1>
        <p>ä¸“ä¸šå¾®ç”Ÿç‰©ä¸°åº¦å¯è§†åŒ–å·¥å…· - æ”¯æŒä»»æ„æ•°é‡æ ·æœ¬ï¼Œè‡ªé€‚åº”å¸ƒå±€</p>
    </div>
    
    <!-- è¯´æ˜ä¹¦æ¨¡æ€æ¡† -->
    <div id="manual-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ä½¿ç”¨è¯´æ˜ä¹¦</h2>
                <span class="close" id="close-modal">&times;</span>
            </div>
            <div class="modal-body" id="manual-content">
                <h3>å¾®ç”Ÿç‰©æ°”æ³¡å›¾ç”Ÿæˆå™¨</h3>
                <p>ä¸€ä¸ªä¸“ä¸šçš„å¾®ç”Ÿç‰©ä¸°åº¦å¯è§†åŒ–å·¥å…·ï¼Œæ”¯æŒä»»æ„æ•°é‡æ ·æœ¬ï¼Œè‡ªåŠ¨è°ƒæ•´å¸ƒå±€ï¼Œç”Ÿæˆç¾è§‚çš„æ°”æ³¡çƒ­å›¾ã€‚</p>
                
                <h3>åŠŸèƒ½ç‰¹ç‚¹</h3>
                <ul>
                    <li><strong>ğŸ“Š æ™ºèƒ½å¯è§†åŒ–</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆå¾®ç”Ÿç‰©ä¸°åº¦æ°”æ³¡å›¾ï¼Œæ°”æ³¡å¤§å°å’Œé¢œè‰²è¡¨ç¤ºå¯¹æ•°è½¬æ¢åçš„æ•°å€¼</li>
                    <li><strong>ğŸ“ çµæ´»æ•°æ®è¾“å…¥</strong>ï¼šæ”¯æŒCSV/TSVæ ¼å¼ï¼Œæ”¯æŒä»»æ„æ•°é‡çš„æ ·æœ¬åˆ—</li>
                    <li><strong>ğŸ¨ å¤šç§é¢œè‰²æ–¹æ¡ˆ</strong>ï¼š8ç§é¢„è®¾é¢œè‰²æ–¹æ¡ˆï¼ˆè“è‰²æ¸å˜ã€Viridisã€Plasmaã€Infernoç­‰ï¼‰</li>
                    <li><strong>ğŸ”¢ å¯¹æ•°è½¬æ¢</strong>ï¼šæ”¯æŒLogâ‚â‚€(RPM+1)å’ŒLogâ‚‚(RPM+1)ä¸¤ç§è½¬æ¢æ–¹å¼</li>
                    <li><strong>ğŸ“ è‡ªé€‚åº”å¸ƒå±€</strong>ï¼šæ ¹æ®æ ·æœ¬å’Œå¾®ç”Ÿç‰©æ•°é‡è‡ªåŠ¨è°ƒæ•´å›¾è¡¨å°ºå¯¸å’Œæ°”æ³¡å¤§å°</li>
                    <li><strong>ğŸ’¾ å¤šæ ¼å¼å¯¼å‡º</strong>ï¼šæ”¯æŒå¯¼å‡ºPNGå›¾ç‰‡ã€PDFæ–‡æ¡£ã€å¤„ç†åçš„æ•°æ®CSVå’ŒåŸå§‹æ•°æ®è¡¨æ ¼</li>
                    <li><strong>ğŸ–±ï¸ äº¤äº’å¼ä½“éªŒ</strong>ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œæ”¯æŒå¤šç§æ˜¾ç¤ºé€‰é¡¹</li>
                </ul>
                
                <h3>å¿«é€Ÿå¼€å§‹</h3>
                <h4>åœ¨çº¿ä½¿ç”¨</h4>
                <ol>
                    <li>é¡µé¢ä¼šè‡ªåŠ¨åŠ è½½ç¤ºä¾‹æ•°æ®å¹¶ç”Ÿæˆå›¾è¡¨</li>
                    <li>ç‚¹å‡»"åŠ è½½ç¤ºä¾‹æ•°æ®ï¼ˆå®é™…æ ¼å¼ï¼‰"æŒ‰é’®å¯ä»¥é‡æ–°åŠ è½½ç¤ºä¾‹æ•°æ®</li>
                </ol>
                
                <h4>ä¸‹è½½ç¤ºä¾‹æ•°æ®</h4>
                <p>ğŸ“¥ <strong>ä¸‹è½½ç¤ºä¾‹CSVæ–‡ä»¶</strong>ï¼š<a href="data-æ°”æ³¡çƒ­å›¾æ•°æ®.csv" class="download-link" download>data-æ°”æ³¡çƒ­å›¾æ•°æ®.csv</a></p>
                <p>æ­¤æ–‡ä»¶åŒ…å«å®é™…çš„æ•°æ®æ ¼å¼ç¤ºä¾‹ï¼ŒåŒ…å«13ä¸ªæ ·æœ¬å’Œ5ç§å¾®ç”Ÿç‰©ï¼Œå¯ä»¥å¸®åŠ©æ‚¨äº†è§£æ­£ç¡®çš„æ•°æ®æ ¼å¼ã€‚</p>
                
                <h3>ä½¿ç”¨æ–¹æ³•</h3>
                
                <h4>1. æ•°æ®å‡†å¤‡</h4>
                <p>å‡†å¤‡CSVæˆ–TSVæ ¼å¼çš„æ•°æ®æ–‡ä»¶ï¼Œæ ¼å¼è¦æ±‚ï¼š</p>
                <ul>
                    <li><strong>ç¬¬ä¸€åˆ—</strong>ï¼šå¾®ç”Ÿç‰©/ç‰©ç§åç§°ï¼ˆæ–‡æœ¬ï¼‰</li>
                    <li><strong>åç»­åˆ—</strong>ï¼šæ ·æœ¬åç§°ï¼ˆåˆ—åï¼‰ï¼Œæ•°å€¼ä¸ºRPMå€¼</li>
                    <li>æ”¯æŒä»»æ„æ•°é‡çš„æ ·æœ¬åˆ—</li>
                    <li>æ”¯æŒå°æ•°å’Œ0å€¼</li>
                </ul>
                
                <p><strong>ç¤ºä¾‹æ•°æ®æ ¼å¼ï¼š</strong></p>
                <pre><code>Species,1: 0: 0: 0: 0,0: 1: 0: 0: 0,0: 0: 1: 0: 0,0: 0: 0: 1: 0,0: 0: 0: 0: 1,1: 3: 0: 0: 0,3: 1: 0: 0: 0,1: 0: 0: 3: 0,0: 1: 0: 3: 0,0: 0: 1: 3: 0,1: 0: 0: 0: 3,0: 1: 0: 0: 3,0: 0: 1: 0: 3
A. fumigatus,109753.74,0,0,0,0,59925.19,82644.69,68440.4,0.19,0.74,132726.97,0,2.28
A. flavus,1.27,42045.49,0,0,0,41218.61,32235.41,1.14,31946.04,0,0,48788.94,1.68
A. terreus,0,0,26640.72,0,0,0,0,0,0.19,12882.18,0,0,18011.76
A. niger,0,0.67,0,2407.22,0,0,0,4167.59,3211.57,4300.01,0,0,0
A. nidulans,0,0,0,0,4588.63,0,0,0,0,0.74,3559.51,3621.15,6223.52</code></pre>
                
                <blockquote>
                    <p>ğŸ’¡ <strong>æç¤º</strong>ï¼šæ‚¨å¯ä»¥ä¸‹è½½ä¸Šé¢çš„ç¤ºä¾‹CSVæ–‡ä»¶ä½œä¸ºå‚è€ƒæ ¼å¼ã€‚</p>
                </blockquote>
                
                <h4>2. ä¸Šä¼ æ•°æ®</h4>
                <p>æœ‰ä¸‰ç§æ–¹å¼åŠ è½½æ•°æ®ï¼š</p>
                <ol>
                    <li><strong>æ‹–æ”¾ä¸Šä¼ </strong>ï¼šç›´æ¥å°†CSV/TSVæ–‡ä»¶æ‹–æ”¾åˆ°ä¸Šä¼ åŒºåŸŸ</li>
                    <li><strong>ç‚¹å‡»é€‰æ‹©</strong>ï¼šç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®ï¼Œä»æ–‡ä»¶æµè§ˆå™¨ä¸­é€‰æ‹©æ–‡ä»¶</li>
                    <li><strong>ç¤ºä¾‹æ•°æ®</strong>ï¼šç‚¹å‡»"åŠ è½½ç¤ºä¾‹æ•°æ®ï¼ˆå®é™…æ ¼å¼ï¼‰"æŒ‰é’®ï¼Œä½¿ç”¨å†…ç½®ç¤ºä¾‹æ•°æ®ï¼ˆè‡ªåŠ¨åŠ è½½ï¼‰</li>
                </ol>
                
                <h4>3. è®¾ç½®å‚æ•°</h4>
                <h5>å¯¹æ•°è½¬æ¢è®¾ç½®</h5>
                <ul>
                    <li><strong>Logâ‚â‚€(RPM+1) è½¬æ¢</strong>ï¼šé€‚ç”¨äºä¸€èˆ¬å¾®ç”Ÿç‰©æ•°æ®åˆ†æï¼ˆé»˜è®¤ï¼‰</li>
                    <li><strong>Logâ‚‚(RPM+1) è½¬æ¢</strong>ï¼šé€‚ç”¨äºåŸºå› è¡¨è¾¾æ•°æ®åˆ†æ</li>
                </ul>
                
                <h5>å¯è§†åŒ–è®¾ç½®</h5>
                <ul>
                    <li><strong>é¢œè‰²æ–¹æ¡ˆ</strong>ï¼šé€‰æ‹©8ç§é¢„è®¾é¢œè‰²æ–¹æ¡ˆä¹‹ä¸€</li>
                    <li><strong>æ°”æ³¡å¤§å°èŒƒå›´</strong>ï¼šè°ƒæ•´æ°”æ³¡çš„æœ€å°å’Œæœ€å¤§å°ºå¯¸ï¼ˆåƒç´ ï¼‰</li>
                    <li><strong>å¯¹æ•°è½¬æ¢å€¼èŒƒå›´</strong>ï¼šè®¾ç½®ç”¨äºé¢œè‰²å’Œå¤§å°æ˜ å°„çš„æ•°å€¼èŒƒå›´</li>
                    <li><strong>æ˜¾ç¤ºé€‰é¡¹</strong>ï¼š
                        <ul>
                            <li>æ˜¾ç¤ºæ ¼å­è¾¹æ¡†</li>
                            <li>åœ¨æ°”æ³¡ä¸­æ˜¾ç¤ºæ•°å€¼</li>
                            <li>åœ¨æ‚¬åœæç¤ºä¸­æ˜¾ç¤ºå¯¹æ•°å€¼</li>
                            <li>æ ¼å¼åŒ–æ•°å€¼ï¼ˆåƒä½åˆ†éš”ç¬¦ï¼‰</li>
                            <li>æ¢è¡Œé•¿æ ·æœ¬åç§°</li>
                            <li>è‡ªåŠ¨æ—‹è½¬æ ·æœ¬æ ‡ç­¾</li>
                        </ul>
                    </li>
                </ul>
                
                <h5>è‡ªåŠ¨è°ƒæ•´åŠŸèƒ½</h5>
                <ul>
                    <li><strong>è‡ªåŠ¨è°ƒæ•´æ°”æ³¡å¤§å°</strong>ï¼šæ ¹æ®æ ·æœ¬å’Œå¾®ç”Ÿç‰©æ•°é‡è‡ªåŠ¨è°ƒæ•´æ°”æ³¡å¤§å°</li>
                    <li><strong>è‡ªåŠ¨è°ƒæ•´æ•°å€¼èŒƒå›´</strong>ï¼šæ ¹æ®æ•°æ®èŒƒå›´è‡ªåŠ¨è°ƒæ•´å¯¹æ•°è½¬æ¢å€¼èŒƒå›´</li>
                    <li><strong>å…¨éƒ¨è‡ªåŠ¨è°ƒæ•´</strong>ï¼šä¸€é”®è‡ªåŠ¨è°ƒæ•´æ‰€æœ‰å‚æ•°</li>
                </ul>
                
                <h4>4. ç”Ÿæˆå›¾è¡¨</h4>
                <p>ç‚¹å‡»"ç”Ÿæˆçƒ­å›¾"æŒ‰é’®ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆæ°”æ³¡å›¾ã€‚å›¾è¡¨ä¼šæ ¹æ®æ•°æ®é‡è‡ªåŠ¨è°ƒæ•´å°ºå¯¸å’Œå¸ƒå±€ã€‚</p>
                
                <h4>5. å¯¼å‡ºç»“æœ</h4>
                <p>æ”¯æŒå¤šç§å¯¼å‡ºæ ¼å¼ï¼š</p>
                <ul>
                    <li><strong>å¯¼å‡ºPNGå›¾ç‰‡</strong>ï¼šå¯¼å‡ºé«˜åˆ†è¾¨ç‡PNGæ ¼å¼å›¾ç‰‡</li>
                    <li><strong>å¯¼å‡ºPDFæ–‡æ¡£</strong>ï¼šå¯¼å‡ºåŒ…å«å›¾è¡¨å’Œå›¾ä¾‹çš„PDFæ–‡æ¡£</li>
                    <li><strong>å¯¼å‡ºå¤„ç†åçš„æ•°æ®</strong>ï¼šå¯¼å‡ºå¯¹æ•°è½¬æ¢åçš„æ•°æ®ï¼ˆCSVæ ¼å¼ï¼‰</li>
                    <li><strong>å¯¼å‡ºæ•°å€¼è¡¨æ ¼</strong>ï¼šå¯¼å‡ºåŸå§‹RPMå€¼æ•°æ®ï¼ˆCSVæ ¼å¼ï¼‰</li>
                </ul>
                
                <h3>æŠ€æœ¯è¯´æ˜</h3>
                <h4>æ•°æ®è½¬æ¢å…¬å¼</h4>
                <ul>
                    <li><strong>Logâ‚â‚€è½¬æ¢</strong>ï¼š<code>Logâ‚â‚€(RPM + 1)</code></li>
                    <li><strong>Logâ‚‚è½¬æ¢</strong>ï¼š<code>Logâ‚‚(RPM + 1)</code></li>
                </ul>
                
                <h4>æ°”æ³¡æ˜ å°„è§„åˆ™</h4>
                <ul>
                    <li><strong>æ°”æ³¡å¤§å°</strong>ï¼šæ ¹æ®å¯¹æ•°è½¬æ¢å€¼åœ¨è®¾å®šèŒƒå›´å†…çº¿æ€§æ˜ å°„åˆ°æ°”æ³¡åŠå¾„</li>
                    <li><strong>æ°”æ³¡é¢œè‰²</strong>ï¼šæ ¹æ®å¯¹æ•°è½¬æ¢å€¼åœ¨è®¾å®šèŒƒå›´å†…æ˜ å°„åˆ°é¢œè‰²æ–¹æ¡ˆ</li>
                </ul>
                
                <h4>è‡ªé€‚åº”è§„åˆ™</h4>
                <ul>
                    <li><strong>æ°”æ³¡å¤§å°</strong>ï¼šæ ¹æ®æ ·æœ¬æ•°é‡å’Œå¾®ç”Ÿç‰©æ•°é‡è‡ªåŠ¨è°ƒæ•´
                        <ul>
                            <li>â‰¤5ä¸ªæ ·æœ¬ï¼š5-35åƒç´ </li>
                            <li>6-10ä¸ªæ ·æœ¬ï¼š4-30åƒç´ </li>
                            <li>11-20ä¸ªæ ·æœ¬ï¼š3-25åƒç´ </li>
                            <li>>20ä¸ªæ ·æœ¬ï¼š2-20åƒç´ </li>
                        </ul>
                    </li>
                    <li><strong>å›¾è¡¨å°ºå¯¸</strong>ï¼šæ ¹æ®æ ·æœ¬å’Œå¾®ç”Ÿç‰©æ•°é‡åŠ¨æ€è®¡ç®—ï¼Œæœ€å°800Ã—500åƒç´ ï¼Œæœ€å¤§2000Ã—1500åƒç´ </li>
                </ul>
                
                <h3>å¸¸è§é—®é¢˜</h3>
                <p><strong>Q: ä¸ºä»€ä¹ˆæœ‰äº›æ°”æ³¡æ˜¾ç¤ºä¸º0ï¼Ÿ</strong><br>
                A: RPMå€¼ä¸º0çš„æ•°æ®ç‚¹ä¸ä¼šæ˜¾ç¤ºæ°”æ³¡ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚</p>
                
                <p><strong>Q: å¦‚ä½•è°ƒæ•´æ°”æ³¡å¤§å°ï¼Ÿ</strong><br>
                A: ä½¿ç”¨"æ°”æ³¡å¤§å°èŒƒå›´"æ»‘å—ï¼Œæˆ–ç‚¹å‡»"è‡ªåŠ¨è°ƒæ•´"æŒ‰é’®è®©ç³»ç»Ÿè‡ªåŠ¨ä¼˜åŒ–ã€‚</p>
                
                <p><strong>Q: æ”¯æŒå“ªäº›æ–‡ä»¶æ ¼å¼ï¼Ÿ</strong><br>
                A: æ”¯æŒCSVï¼ˆé€—å·åˆ†éš”ï¼‰å’ŒTSVï¼ˆåˆ¶è¡¨ç¬¦åˆ†éš”ï¼‰æ ¼å¼ã€‚</p>
                
                <p><strong>Q: å¯ä»¥å¤„ç†å¤šå°‘æ ·æœ¬ï¼Ÿ</strong><br>
                A: ç†è®ºä¸Šæ”¯æŒä»»æ„æ•°é‡çš„æ ·æœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´å¸ƒå±€ä»¥é€‚åº”æ•°æ®é‡ã€‚</p>
                
                <p><strong>Q: å¯¼å‡ºçš„å›¾ç‰‡åˆ†è¾¨ç‡å¦‚ä½•ï¼Ÿ</strong><br>
                A: PNGå¯¼å‡ºä½¿ç”¨SVGè½¬æ¢ï¼ŒPDFå¯¼å‡ºä½¿ç”¨2å€åˆ†è¾¨ç‡ï¼Œç¡®ä¿é«˜è´¨é‡è¾“å‡ºã€‚</p>
                
                <h3>æ•°æ®éšç§</h3>
                <p><strong>é‡è¦æç¤º</strong>ï¼šæ‰€æœ‰æ•°æ®å¤„ç†éƒ½åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚</p>
                
                <h3>ç‰ˆæœ¬ä¿¡æ¯</h3>
                <p><strong>å½“å‰ç‰ˆæœ¬</strong>ï¼šv1.6.2<br>
                <strong>æ›´æ–°æ—¥æœŸ</strong>ï¼š2025å¹´</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="panel">
            <h2>æ•°æ®ä¸Šä¼ </h2>
            <div class="form-group">
                <div class="file-upload" id="drop-area">
                    <i>ğŸ“</i>
                    <p>æ‹–æ”¾CSV/TSVæ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <button class="btn" id="browse-btn">é€‰æ‹©æ–‡ä»¶</button>
                    <input type="file" id="file-input" accept=".csv,.txt,.tsv">
                    <p class="file-info" id="file-info">å°šæœªé€‰æ‹©æ–‡ä»¶</p>
                </div>
            </div>
            
            <div class="instructions">
                <h3>æ•°æ®æ ¼å¼è¦æ±‚</h3>
                <ul>
                    <li>ç¬¬ä¸€åˆ—ï¼šå¾®ç”Ÿç‰©/ç‰©ç§åç§°ï¼ˆæ–‡æœ¬ï¼‰</li>
                    <li>åç»­åˆ—ï¼šæ ·æœ¬åç§°ï¼ˆåˆ—åï¼‰ï¼Œæ•°å€¼ä¸ºRPMå€¼</li>
                    <li>æ”¯æŒCSVæˆ–TSVæ ¼å¼</li>
                    <li><strong>æ”¯æŒä»»æ„æ•°é‡çš„æ ·æœ¬åˆ—</strong>ï¼ˆè‡ªåŠ¨é€‚åº”ï¼‰</li>
                    <li>ç¤ºä¾‹æ•°æ®æ ¼å¼ï¼š</li>
                </ul>
                <div class="sample-data">
                    <h4>ç¤ºä¾‹æ•°æ®æ ¼å¼ï¼š</h4>
                    <pre>Species,1: 0: 0: 0: 0,0: 1: 0: 0: 0,0: 0: 1: 0: 0,0: 0: 0: 1: 0,0: 0: 0: 0: 1,1: 3: 0: 0: 0,3: 1: 0: 0: 0,1: 0: 0: 3: 0,0: 1: 0: 3: 0,0: 0: 1: 3: 0,1: 0: 0: 0: 3,0: 1: 0: 0: 3,0: 0: 1: 0: 3
A. fumigatus,109753.74,0,0,0,0,59925.19,82644.69,68440.4,0.19,0.74,132726.97,0,2.28
A. flavus,1.27,42045.49,0,0,0,41218.61,32235.41,1.14,31946.04,0,0,48788.94,1.68
A. terreus,0,0,26640.72,0,0,0,0,0,0.19,12882.18,0,0,18011.76
A. niger,0,0.67,0,2407.22,0,0,0,4167.59,3211.57,4300.01,0,0,0
A. nidulans,0,0,0,0,4588.63,0,0,0,0,0.74,3559.51,3621.15,6223.52</pre>
                    <p style="font-size: 0.85rem; color: #6c757d; margin-top: 8px;">
                        <strong>è¯´æ˜ï¼š</strong>ç¬¬ä¸€åˆ—ä¸ºç‰©ç§åç§°ï¼Œåç»­åˆ—ä¸ºæ ·æœ¬åç§°ï¼ˆå¯ä»¥æ˜¯ä»»æ„æ ¼å¼ï¼‰ï¼Œæ•°å€¼ä¸ºRPMå€¼ã€‚æ”¯æŒå°æ•°å’Œ0å€¼ã€‚
                    </p>
                </div>
            </div>
            
            <div class="log-base-selector">
                <h4>å¯¹æ•°è½¬æ¢è®¾ç½®</h4>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="log10" name="log-base" value="10" checked>
                        <label for="log10">Logâ‚â‚€(RPM+1) è½¬æ¢</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="log2" name="log-base" value="2">
                        <label for="log2">Logâ‚‚(RPM+1) è½¬æ¢</label>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #495057; margin-top: 10px;">
                    æ°”æ³¡å¤§å°å’Œé¢œè‰²éƒ½è¡¨ç¤ºå¯¹æ•°è½¬æ¢åçš„æ•°å€¼ã€‚é€‰æ‹©Logâ‚‚è½¬æ¢é€‚ç”¨äºåŸºå› è¡¨è¾¾æ•°æ®åˆ†æã€‚
                </p>
            </div>
            
            <div class="form-group">
                <button class="btn btn-secondary" id="load-sample-btn">åŠ è½½ç¤ºä¾‹æ•°æ®ï¼ˆå®é™…æ ¼å¼ï¼‰</button>
                <p style="font-size: 0.85rem; color: #6c757d; margin-top: 8px;">
                    ç‚¹å‡»æ­¤æŒ‰é’®å¯åŠ è½½å®é™…æ•°æ®æ ¼å¼ç¤ºä¾‹ï¼ŒåŒ…å«13ä¸ªæ ·æœ¬å’Œ5ç§å¾®ç”Ÿç‰©ï¼Œå¸®åŠ©æ‚¨äº†è§£æ­£ç¡®çš„æ•°æ®æ ¼å¼ã€‚
                </p>
            </div>
            
            <div id="status-message" class="status-message"></div>
            
            <div id="samples-info" class="samples-info" style="display: none;">
                <p><strong>æ•°æ®ä¿¡æ¯:</strong> <span id="microbes-count">0</span> ä¸ªå¾®ç”Ÿç‰©ï¼Œ<span id="samples-count">0</span> ä¸ªæ ·æœ¬</p>
            </div>
        </div>
        
        <div class="panel">
            <h2>å¯è§†åŒ–è®¾ç½®</h2>
            
            <div class="form-group">
                <label>é¢œè‰²æ–¹æ¡ˆï¼š</label>
                <select id="color-scheme">
                    <option value="blue-gradient">è“è‰²æ¸å˜</option>
                    <option value="blue-white">ç™½è“æ¸å˜</option>
                    <option value="viridis">Viridis</option>
                    <option value="plasma">Plasma</option>
                    <option value="red-yellow">çº¢é»„æ¸å˜</option>
                    <option value="green-gradient">ç»¿è‰²æ¸å˜</option>
                    <option value="inferno">Inferno</option>
                    <option value="magma">Magma</option>
                </select>
            </div>
            
            <div class="form-group">
                <div class="adaptive-controls">
                    <div>
                        <label>æ°”æ³¡å¤§å°èŒƒå›´ï¼š <span id="size-min-value" class="range-value">5</span> - <span id="size-max-value" class="range-value">30</span></label>
                    </div>
                    <button class="btn btn-secondary" id="adaptive-size-btn" style="font-size: 0.8rem; padding: 5px 10px;">
                        è‡ªåŠ¨è°ƒæ•´
                    </button>
                </div>
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label style="font-size: 0.9rem;">æœ€å°å€¼</label>
                        <input type="range" id="size-min" min="2" max="15" step="1" value="5">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 0.9rem;">æœ€å¤§å€¼</label>
                        <input type="range" id="size-max" min="15" max="50" step="1" value="30">
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #6c757d; margin-top: 5px;">æ°”æ³¡å¤§å°èŒƒå›´ï¼ˆåƒç´ ï¼‰ï¼Œæ ¹æ®æ ·æœ¬æ•°é‡è‡ªåŠ¨è°ƒæ•´</p>
            </div>
            
            <div class="form-group">
                <div class="adaptive-controls">
                    <div>
                        <label>å¯¹æ•°è½¬æ¢å€¼èŒƒå›´ï¼š <span id="log-min-value" class="range-value">0</span> - <span id="log-max-value" class="range-value">8</span></label>
                    </div>
                    <button class="btn btn-secondary" id="adaptive-range-btn" style="font-size: 0.8rem; padding: 5px 10px;">
                        è‡ªåŠ¨è°ƒæ•´
                    </button>
                </div>
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label style="font-size: 0.9rem;">æœ€å°å€¼</label>
                        <input type="range" id="log-min" min="0" max="5" step="0.5" value="0">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 0.9rem;">æœ€å¤§å€¼</label>
                        <input type="range" id="log-max" min="5" max="15" step="0.5" value="8">
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: #6c757d; margin-top: 5px;">ç”¨äºé¢œè‰²å’Œå¤§å°æ˜ å°„çš„æ•°å€¼èŒƒå›´</p>
            </div>
            
            <div class="form-group">
                <label>æ˜¾ç¤ºè®¾ç½®ï¼š</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-grid" checked>
                    <label for="show-grid">æ˜¾ç¤ºæ ¼å­è¾¹æ¡†</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-values" checked>
                    <label for="show-values">åœ¨æ°”æ³¡ä¸­æ˜¾ç¤ºæ•°å€¼</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-log-values" checked>
                    <label for="show-log-values">åœ¨æ‚¬åœæç¤ºä¸­æ˜¾ç¤ºå¯¹æ•°å€¼</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="format-numbers" checked>
                    <label for="format-numbers">æ ¼å¼åŒ–æ•°å€¼ï¼ˆåƒä½åˆ†éš”ç¬¦ï¼‰</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="wrap-text" checked>
                    <label for="wrap-text">æ¢è¡Œé•¿æ ·æœ¬åç§°</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="auto-rotate" checked>
                    <label for="auto-rotate">è‡ªåŠ¨æ—‹è½¬æ ·æœ¬æ ‡ç­¾</label>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="generate-btn">ç”Ÿæˆçƒ­å›¾</button>
                <button class="btn btn-secondary" id="reset-btn">é‡ç½®è®¾ç½®</button>
                <button class="btn btn-secondary" id="auto-scale-btn">å…¨éƒ¨è‡ªåŠ¨è°ƒæ•´</button>
            </div>
        </div>
    </div>
    
    <div class="visualization-container">
        <h2>å¯è§†åŒ–ç»“æœ</h2>
        <div id="chart-container">
            <!-- ä½¿ç”¨D3.jsç»˜åˆ¶å›¾è¡¨ -->
        </div>
        
        <div class="legend" id="legend-container">
            <!-- å›¾ä¾‹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="btn-group">
            <button class="btn btn-success" id="export-png-btn">å¯¼å‡ºPNGå›¾ç‰‡</button>
            <button class="btn btn-success" id="export-pdf-btn">å¯¼å‡ºPDFæ–‡æ¡£</button>
            <button class="btn btn-secondary" id="export-data-btn">å¯¼å‡ºå¤„ç†åçš„æ•°æ®</button>
            <button class="btn btn-secondary" id="export-table-btn">å¯¼å‡ºæ•°å€¼è¡¨æ ¼</button>
        </div>
        
        <div class="data-preview">
            <h3>æ•°æ®é¢„è§ˆ (åŸå§‹RPMå€¼)</h3>
            <div id="data-table-container">
                <p>ä¸Šä¼ æ•°æ®åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºåŸå§‹æ•°æ®é¢„è§ˆ</p>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Â© 2025 å¾®ç”Ÿç‰©å¯è§†åŒ–å·¥å…· | åŸºäºD3.jså’ŒJavaScriptæ„å»º | æ•°æ®åœ¨æµè§ˆå™¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
        <p style="font-size: 0.8rem; margin-top: 5px;">æ”¯æŒä»»æ„æ•°é‡æ ·æœ¬ï¼Œè‡ªåŠ¨è°ƒæ•´å¸ƒå±€</p>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let rawData = null;
        let processedData = null;
        let chartSVG = null;
        
        // DOMå…ƒç´ 
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const browseBtn = document.getElementById('browse-btn');
        const fileInfo = document.getElementById('file-info');
        const loadSampleBtn = document.getElementById('load-sample-btn');
        const generateBtn = document.getElementById('generate-btn');
        const resetBtn = document.getElementById('reset-btn');
        const autoScaleBtn = document.getElementById('auto-scale-btn');
        const exportPngBtn = document.getElementById('export-png-btn');
        const exportPdfBtn = document.getElementById('export-pdf-btn');
        const exportDataBtn = document.getElementById('export-data-btn');
        const exportTableBtn = document.getElementById('export-table-btn');
        const statusMessage = document.getElementById('status-message');
        const dataTableContainer = document.getElementById('data-table-container');
        const chartContainer = document.getElementById('chart-container');
        const legendContainer = document.getElementById('legend-container');
        const samplesInfo = document.getElementById('samples-info');
        const microbesCount = document.getElementById('microbes-count');
        const samplesCount = document.getElementById('samples-count');
        const adaptiveSizeBtn = document.getElementById('adaptive-size-btn');
        const adaptiveRangeBtn = document.getElementById('adaptive-range-btn');
        
        // è®¾ç½®å…ƒç´ 
        const colorScheme = document.getElementById('color-scheme');
        const sizeMin = document.getElementById('size-min');
        const sizeMax = document.getElementById('size-max');
        const logMin = document.getElementById('log-min');
        const logMax = document.getElementById('log-max');
        const showValues = document.getElementById('show-values');
        const showGrid = document.getElementById('show-grid');
        const showLogValues = document.getElementById('show-log-values');
        const formatNumbers = document.getElementById('format-numbers');
        const wrapText = document.getElementById('wrap-text');
        const autoRotate = document.getElementById('auto-rotate');
        const log10Radio = document.getElementById('log10');
        const log2Radio = document.getElementById('log2');
        
        // èŒƒå›´å€¼æ˜¾ç¤ºå…ƒç´ 
        const sizeMinValue = document.getElementById('size-min-value');
        const sizeMaxValue = document.getElementById('size-max-value');
        const logMinValue = document.getElementById('log-min-value');
        const logMaxValue = document.getElementById('log-max-value');
        
        // ç¤ºä¾‹æ•°æ® (ä½¿ç”¨å®é™…æ•°æ®æ ¼å¼)
        const sampleData = `Species,1: 0: 0: 0: 0,0: 1: 0: 0: 0,0: 0: 1: 0: 0,0: 0: 0: 1: 0,0: 0: 0: 0: 1,1: 3: 0: 0: 0,3: 1: 0: 0: 0,1: 0: 0: 3: 0,0: 1: 0: 3: 0,0: 0: 1: 3: 0,1: 0: 0: 0: 3,0: 1: 0: 0: 3,0: 0: 1: 0: 3
A. fumigatus,109753.74,0,0,0,0,59925.19,82644.69,68440.4,0.19,0.74,132726.97,0,2.28
A. flavus,1.27,42045.49,0,0,0,41218.61,32235.41,1.14,31946.04,0,0,48788.94,1.68
A. terreus,0,0,26640.72,0,0,0,0,0,0.19,12882.18,0,0,18011.76
A. niger,0,0.67,0,2407.22,0,0,0,4167.59,3211.57,4300.01,0,0,0
A. nidulans,0,0,0,0,4588.63,0,0,0,0,0.74,3559.51,3621.15,6223.52`;
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // æ–‡ä»¶é€‰æ‹©
            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ”¾åŠŸèƒ½
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect();
                }
            });
            
            // åŠ è½½ç¤ºä¾‹æ•°æ®
            loadSampleBtn.addEventListener('click', loadSampleData);
            
            // ç”Ÿæˆå›¾è¡¨
            generateBtn.addEventListener('click', generateChart);
            
            // é‡ç½®è®¾ç½®
            resetBtn.addEventListener('click', resetSettings);
            
            // è‡ªåŠ¨è°ƒæ•´èŒƒå›´
            autoScaleBtn.addEventListener('click', autoScaleRanges);
            adaptiveSizeBtn.addEventListener('click', adaptiveSizeSettings);
            adaptiveRangeBtn.addEventListener('click', adaptiveRangeSettings);
            
            // å¯¼å‡ºåŠŸèƒ½
            exportPngBtn.addEventListener('click', exportAsPNG);
            exportPdfBtn.addEventListener('click', exportAsPDF);
            exportDataBtn.addEventListener('click', exportData);
            exportTableBtn.addEventListener('click', exportTable);
            
            // èŒƒå›´æ»‘å—å€¼æ›´æ–°
            sizeMin.addEventListener('input', () => {
                sizeMinValue.textContent = sizeMin.value;
                if (parseFloat(sizeMin.value) > parseFloat(sizeMax.value)) {
                    sizeMax.value = sizeMin.value;
                    sizeMaxValue.textContent = sizeMax.value;
                }
                if (processedData) generateChart();
            });
            
            sizeMax.addEventListener('input', () => {
                sizeMaxValue.textContent = sizeMax.value;
                if (parseFloat(sizeMax.value) < parseFloat(sizeMin.value)) {
                    sizeMin.value = sizeMax.value;
                    sizeMinValue.textContent = sizeMin.value;
                }
                if (processedData) generateChart();
            });
            
            logMin.addEventListener('input', () => {
                logMinValue.textContent = logMin.value;
                if (parseFloat(logMin.value) > parseFloat(logMax.value)) {
                    logMax.value = logMin.value;
                    logMaxValue.textContent = logMax.value;
                }
                if (processedData) generateChart();
            });
            
            logMax.addEventListener('input', () => {
                logMaxValue.textContent = logMax.value;
                if (parseFloat(logMax.value) < parseFloat(logMin.value)) {
                    logMin.value = logMax.value;
                    logMinValue.textContent = logMin.value;
                }
                if (processedData) generateChart();
            });
            
            // å…¶ä»–è®¾ç½®å˜åŒ–æ—¶é‡æ–°ç”Ÿæˆå›¾è¡¨
            colorScheme.addEventListener('change', generateChart);
            showValues.addEventListener('change', generateChart);
            showGrid.addEventListener('change', generateChart);
            showLogValues.addEventListener('change', generateChart);
            formatNumbers.addEventListener('change', generateChart);
            wrapText.addEventListener('change', generateChart);
            autoRotate.addEventListener('change', generateChart);
            
            log10Radio.addEventListener('change', () => {
                if (processedData) {
                    processData(rawData);
                    autoScaleRanges();
                    generateChart();
                }
            });
            log2Radio.addEventListener('change', () => {
                if (processedData) {
                    processData(rawData);
                    autoScaleRanges();
                    generateChart();
                }
            });
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect() {
            if (!fileInput.files.length) return;
            
            const file = fileInput.files[0];
            fileInfo.textContent = `å·²é€‰æ‹©: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
            
            Papa.parse(file, {
                complete: function(results) {
                    if (results.errors.length) {
                        showStatus('æ–‡ä»¶è§£æé”™è¯¯: ' + results.errors[0].message, 'error');
                        return;
                    }
                    
                    rawData = results.data;
                    processData(rawData);
                    showStatus('æ•°æ®åŠ è½½æˆåŠŸ!', 'success');
                    autoScaleRanges();
                    generateChart();
                },
                error: function(error) {
                    showStatus('æ–‡ä»¶è¯»å–é”™è¯¯: ' + error.message, 'error');
                },
                header: true,
                skipEmptyLines: true
            });
        }
        
        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadSampleData() {
            Papa.parse(sampleData, {
                complete: function(results) {
                    rawData = results.data;
                    processData(rawData);
                    fileInfo.textContent = 'å·²åŠ è½½ç¤ºä¾‹æ•°æ®';
                    showStatus('ç¤ºä¾‹æ•°æ®åŠ è½½æˆåŠŸ!', 'success');
                    autoScaleRanges();
                    generateChart();
                },
                header: true,
                skipEmptyLines: true
            });
        }
        
        // è·å–å½“å‰é€‰ä¸­çš„å¯¹æ•°åº•æ•°
        function getLogBase() {
            return log10Radio.checked ? 10 : 2;
        }
        
        // è·å–å¯¹æ•°å‡½æ•°
        function getLogFunction() {
            const base = getLogBase();
            if (base === 10) {
                return x => Math.log10(x + 1);
            } else {
                return x => Math.log2(x + 1);
            }
        }
        
        // è·å–å¯¹æ•°æ ‡ç­¾
        function getLogLabel() {
            const base = getLogBase();
            return base === 10 ? 'Logâ‚â‚€' : 'Logâ‚‚';
        }
        
        // å¤„ç†æ•°æ®
        function processData(data) {
            if (!data || data.length === 0) {
                showStatus('æ•°æ®ä¸ºç©ºï¼Œæ— æ³•å¤„ç†', 'error');
                return;
            }
            
            // è·å–å¾®ç”Ÿç‰©åç§°å’Œæ ·æœ¬åç§°
            const microbes = [];
            const samples = Object.keys(data[0]).slice(1); // ç¬¬ä¸€åˆ—æ˜¯å¾®ç”Ÿç‰©åï¼Œå…¶ä½™æ˜¯æ ·æœ¬
            
            // è½¬æ¢æ•°æ®ä¸ºé•¿æ ¼å¼
            const longFormatData = [];
            let minLogValue = Infinity;
            let maxLogValue = -Infinity;
            
            const logFunc = getLogFunction();
            
            data.forEach(row => {
                const microbe = row[Object.keys(row)[0]]; // è·å–ç¬¬ä¸€åˆ—çš„å€¼ï¼ˆå¾®ç”Ÿç‰©åï¼‰
                microbes.push(microbe);
                
                samples.forEach(sample => {
                    const rpm = parseFloat(row[sample]) || 0;
                    const logValue = logFunc(rpm);
                    
                    // æ›´æ–°æœ€å°å’Œæœ€å¤§å€¼ï¼ˆæ’é™¤0çš„æƒ…å†µï¼‰
                    if (rpm > 0) {
                        minLogValue = Math.min(minLogValue, logValue);
                        maxLogValue = Math.max(maxLogValue, logValue);
                    }
                    
                    longFormatData.push({
                        microbe: microbe,
                        sample: sample,
                        rpm: rpm,
                        logValue: logValue
                    });
                });
            });
            
            processedData = {
                microbes: microbes,
                samples: samples,
                data: longFormatData,
                minLogValue: minLogValue === Infinity ? 0 : minLogValue,
                maxLogValue: maxLogValue === -Infinity ? 1 : maxLogValue,
                logBase: getLogBase(),
                logLabel: getLogLabel()
            };
            
            // æ˜¾ç¤ºæ•°æ®ä¿¡æ¯
            microbesCount.textContent = microbes.length;
            samplesCount.textContent = samples.length;
            samplesInfo.style.display = 'block';
            
            // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
            displayDataPreview();
        }
        
        // è‡ªé€‚åº”è°ƒæ•´æ°”æ³¡å¤§å°
        function adaptiveSizeSettings() {
            if (!processedData) {
                showStatus('è¯·å…ˆä¸Šä¼ æ•°æ®', 'info');
                return;
            }
            
            // æ ¹æ®æ ·æœ¬æ•°é‡è°ƒæ•´æ°”æ³¡å¤§å°
            const sampleCount = processedData.samples.length;
            const microbeCount = processedData.microbes.length;
            
            let baseSize, maxSize;
            
            if (sampleCount <= 5) {
                baseSize = 5;
                maxSize = 35;
            } else if (sampleCount <= 10) {
                baseSize = 4;
                maxSize = 30;
            } else if (sampleCount <= 20) {
                baseSize = 3;
                maxSize = 25;
            } else {
                baseSize = 2;
                maxSize = 20;
            }
            
            // å¦‚æœå¾®ç”Ÿç‰©æ•°é‡å¾ˆå¤šï¼Œè¿›ä¸€æ­¥å‡å°æ°”æ³¡å¤§å°
            if (microbeCount > 15) {
                baseSize = Math.max(2, baseSize - 1);
                maxSize = Math.max(15, maxSize - 5);
            }
            
            sizeMin.value = baseSize;
            sizeMax.value = maxSize;
            
            sizeMinValue.textContent = sizeMin.value;
            sizeMaxValue.textContent = sizeMax.value;
            
            showStatus(`å·²æ ¹æ®æ ·æœ¬æ•°é‡(${sampleCount})å’Œå¾®ç”Ÿç‰©æ•°é‡(${microbeCount})è°ƒæ•´æ°”æ³¡å¤§å°`, 'success');
            if (processedData) generateChart();
        }
        
        // è‡ªé€‚åº”è°ƒæ•´æ•°å€¼èŒƒå›´
        function adaptiveRangeSettings() {
            if (!processedData) {
                showStatus('è¯·å…ˆä¸Šä¼ æ•°æ®', 'info');
                return;
            }
            
            // è‡ªåŠ¨è°ƒæ•´LogèŒƒå›´
            const minLog = Math.floor(processedData.minLogValue * 10) / 10;
            const maxLog = Math.ceil(processedData.maxLogValue * 10) / 10;
            
            logMin.value = Math.max(0, minLog - 0.5);
            logMax.value = maxLog + 0.5;
            
            // æ›´æ–°æ˜¾ç¤º
            logMinValue.textContent = logMin.value;
            logMaxValue.textContent = logMax.value;
            
            showStatus(`å·²è‡ªåŠ¨è°ƒæ•´å¯¹æ•°èŒƒå›´: ${logMin.value} - ${logMax.value}`, 'success');
            if (processedData) generateChart();
        }
        
        // è‡ªåŠ¨è°ƒæ•´èŒƒå›´
        function autoScaleRanges() {
            if (!processedData) {
                showStatus('è¯·å…ˆä¸Šä¼ æ•°æ®', 'info');
                return;
            }
            
            adaptiveSizeSettings();
            adaptiveRangeSettings();
            showStatus('å·²å®Œæˆå…¨éƒ¨è‡ªåŠ¨è°ƒæ•´', 'success');
        }
        
        // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
        function displayDataPreview() {
            if (!processedData || !rawData) return;
            
            const table = document.createElement('table');
            table.className = 'data-table';
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            // æ·»åŠ å¾®ç”Ÿç‰©åˆ—
            const th1 = document.createElement('th');
            th1.textContent = 'å¾®ç”Ÿç‰©';
            headerRow.appendChild(th1);
            
            // æ·»åŠ æ ·æœ¬åˆ—
            processedData.samples.forEach(sample => {
                const th = document.createElement('th');
                th.textContent = sample;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨æ ¼ä¸»ä½“
            const tbody = document.createElement('tbody');
            
            // è·å–å”¯ä¸€çš„å¾®ç”Ÿç‰©
            const uniqueMicrobes = [...new Set(processedData.data.map(d => d.microbe))];
            
            uniqueMicrobes.forEach(microbe => {
                const tr = document.createElement('tr');
                
                // æ·»åŠ å¾®ç”Ÿç‰©åç§°
                const td1 = document.createElement('td');
                td1.textContent = microbe;
                td1.style.fontWeight = 'bold';
                td1.style.fontStyle = 'italic';
                tr.appendChild(td1);
                
                // æ·»åŠ æ ·æœ¬æ•°æ®ï¼ˆåŸå§‹RPMå€¼ï¼‰
                processedData.samples.forEach(sample => {
                    const td = document.createElement('td');
                    const dataPoint = processedData.data.find(d => d.microbe === microbe && d.sample === sample);
                    const rpm = dataPoint.rpm;
                    
                    // æ ¼å¼åŒ–æ•°å€¼
                    if (formatNumbers.checked && rpm >= 1000) {
                        td.textContent = rpm.toLocaleString('en-US', {maximumFractionDigits: 0});
                    } else {
                        td.textContent = rpm === 0 ? '0' : rpm.toFixed(2);
                    }
                    
                    // æ ¹æ®RPMå€¼æ·»åŠ èƒŒæ™¯è‰²
                    if (rpm === 0) {
                        td.style.backgroundColor = '#f8f9fa';
                        td.style.color = '#adb5bd';
                    } else if (rpm > 100000) {
                        td.style.backgroundColor = '#e7f5ff';
                    } else if (rpm > 10000) {
                        td.style.backgroundColor = '#d0ebff';
                    } else if (rpm > 1000) {
                        td.style.backgroundColor = '#a5d8ff';
                    }
                    
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });
            
            table.appendChild(tbody);
            
            // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ è¡¨æ ¼
            dataTableContainer.innerHTML = '<p>åŸå§‹RPMå€¼é¢„è§ˆ:</p>';
            dataTableContainer.appendChild(table);
        }
        
        // æ ¼å¼åŒ–æ•°å€¼
        function formatNumber(num) {
            if (!formatNumbers.checked) return num.toFixed(2);
            
            if (num >= 1000) {
                return num.toLocaleString('en-US', {maximumFractionDigits: 0});
            } else if (num >= 100) {
                return num.toFixed(0);
            } else if (num >= 10) {
                return num.toFixed(1);
            } else {
                return num.toFixed(2);
            }
        }
        
        // ç”Ÿæˆå›¾è¡¨ (ä½¿ç”¨D3.js)
        function generateChart() {
            if (!processedData) {
                showStatus('è¯·å…ˆä¸Šä¼ æ•°æ®', 'info');
                return;
            }
            
            // æ¸…ç©ºå›¾è¡¨å®¹å™¨
            chartContainer.innerHTML = '';
            
            // æ ¹æ®æ ·æœ¬æ•°é‡åŠ¨æ€è°ƒæ•´å›¾è¡¨å°ºå¯¸
            const sampleCount = processedData.samples.length;
            const microbeCount = processedData.microbes.length;
            
            // åŠ¨æ€è®¡ç®—è¾¹è·å’Œå°ºå¯¸
            const baseMargin = {top: 80, right: 50, bottom: 150, left: 200};
            
            // æ ¹æ®æ ·æœ¬æ•°é‡è°ƒæ•´å·¦è¾¹è·ï¼ˆå¾®ç”Ÿç‰©åç§°å¯èƒ½è¾ƒé•¿ï¼‰
            const leftMargin = Math.max(200, Math.min(300, microbeCount * 8));
            
            // æ ¹æ®æ ·æœ¬æ•°é‡è°ƒæ•´åº•è¾¹è·
            let bottomMargin = 150;
            if (sampleCount > 15) {
                bottomMargin = 200;
            } else if (sampleCount > 10) {
                bottomMargin = 180;
            }
            
            const margin = {
                top: 80, 
                right: 50, 
                bottom: bottomMargin, 
                left: leftMargin
            };
            
            // åŠ¨æ€è®¡ç®—å®½åº¦
            const minWidth = 800;
            const maxWidth = 2000;
            const width = Math.max(minWidth, Math.min(maxWidth, sampleCount * 60 + margin.left + margin.right));
            
            // åŠ¨æ€è®¡ç®—é«˜åº¦
            const minHeight = 500;
            const maxHeight = 1500;
            const height = Math.max(minHeight, Math.min(maxHeight, microbeCount * 40 + margin.top + margin.bottom));
            
            // è®¾ç½®å®¹å™¨å°ºå¯¸
            chartContainer.style.height = `${height}px`;
            
            // åˆ›å»ºSVG
            const svg = d3.select("#chart-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            chartSVG = svg;
            
            // è·å–æ•°æ®
            const microbes = processedData.microbes;
            const samples = processedData.samples;
            const data = processedData.data;
            const logLabel = getLogLabel();
            
            // è®¡ç®—å®é™…ç»˜å›¾åŒºåŸŸ
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;
            
            // åˆ›å»ºæ¯”ä¾‹å°º
            const xScale = d3.scaleBand()
                .domain(samples)
                .range([0, plotWidth])
                .padding(0); // æ·»åŠ ä¸€ç‚¹padding
            
            const yScale = d3.scaleBand()
                .domain(microbes)
                .range([0, plotHeight])
                .padding(0);
            
            // é¢œè‰²æ¯”ä¾‹å°º
            const colorScale = d3.scaleSequential()
                .domain([parseFloat(logMin.value), parseFloat(logMax.value)])
                .interpolator(getColorInterpolator());
            
            // æ°”æ³¡å¤§å°æ¯”ä¾‹å°º
            const sizeScale = d3.scaleLinear()
                .domain([parseFloat(logMin.value), parseFloat(logMax.value)])
                .range([parseFloat(sizeMin.value), parseFloat(sizeMax.value)]);
            
            // ç»˜åˆ¶æ ¼å­èƒŒæ™¯
            if (showGrid.checked) {
                svg.selectAll(".grid-cell")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "grid-cell")
                    .attr("x", d => xScale(d.sample))
                    .attr("y", d => yScale(d.microbe))
                    .attr("width", xScale.bandwidth())
                    .attr("height", yScale.bandwidth())
                    .attr("fill", "white")
                    .attr("stroke", "#e0e0e0")
                    .attr("stroke-width", 1)
                    .attr("shape-rendering", "crispEdges");
            }
            
            // ç»˜åˆ¶æ°”æ³¡
            const bubbles = svg.selectAll(".bubble")
                .data(data.filter(d => d.rpm > 0))
                .enter()
                .append("circle")
                .attr("class", "bubble")
                .attr("cx", d => xScale(d.sample) + xScale.bandwidth() / 2)
                .attr("cy", d => yScale(d.microbe) + yScale.bandwidth() / 2)
                .attr("r", d => sizeScale(d.logValue))
                .attr("fill", d => colorScale(d.logValue))
                .attr("stroke", "rgba(0,0,0,0.2)")
                .attr("stroke-width", 1)
                .attr("opacity", 0.9)
                .on("mouseover", function(event, d) {
                    // æ˜¾ç¤ºå·¥å…·æç¤º
                    const tooltip = d3.select("body")
                        .append("div")
                        .attr("class", "tooltip")
                        .style("position", "absolute")
                        .style("background-color", "white")
                        .style("border", "1px solid #ddd")
                        .style("border-radius", "5px")
                        .style("padding", "10px")
                        .style("box-shadow", "0 2px 10px rgba(0,0,0,0.1)")
                        .style("pointer-events", "none")
                        .style("z-index", "1000");
                    
                    let tooltipHtml = `<div style="font-weight: bold; margin-bottom: 5px;">${d.microbe}</div>`;
                    tooltipHtml += `<div style="margin-bottom: 3px;"><strong>æ ·æœ¬:</strong> ${d.sample}</div>`;
                    tooltipHtml += `<div style="margin-bottom: 3px;"><strong>RPM:</strong> ${formatNumber(d.rpm)}</div>`;
                    if (showLogValues.checked) {
                        tooltipHtml += `<div><strong>${logLabel}(RPM+1):</strong> ${d.logValue.toFixed(3)}</div>`;
                    }
                    
                    tooltip.html(tooltipHtml)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                    
                    // é«˜äº®å½“å‰æ°”æ³¡
                    d3.select(this)
                        .attr("stroke", "rgba(0,0,0,0.5)")
                        .attr("stroke-width", 2);
                })
                .on("mouseout", function() {
                    // ç§»é™¤å·¥å…·æç¤º
                    d3.selectAll(".tooltip").remove();
                    
                    // æ¢å¤æ°”æ³¡æ ·å¼
                    d3.select(this)
                        .attr("stroke", "rgba(0,0,0,0.2)")
                        .attr("stroke-width", 1);
                });
            
            // æ·»åŠ æ•°å€¼æ ‡ç­¾åˆ°æ°”æ³¡
            if (showValues.checked) {
                svg.selectAll(".bubble-text")
                    .data(data.filter(d => d.rpm > 0))
                    .enter()
                    .append("text")
                    .attr("class", "bubble-text")
                    .attr("x", d => xScale(d.sample) + xScale.bandwidth() / 2)
                    .attr("y", d => yScale(d.microbe) + yScale.bandwidth() / 2)
                    .attr("dy", "0.3em")
                    .text(d => {
                        if (d.rpm === 0) return "";
                        const size = sizeScale(d.logValue);
                        // æ ¹æ®æ°”æ³¡å¤§å°è°ƒæ•´å­—ä½“å¤§å°
                        const fontSize = Math.max(6, Math.min(12, size / 2));
                        d3.select(this).attr("font-size", fontSize);
                        
                        // æ ¼å¼åŒ–æ•°å€¼
                        if (d.rpm >= 1000) {
                            return formatNumber(d.rpm);
                        } else {
                            return d.rpm.toFixed(1);
                        }
                    })
                    .attr("text-anchor", "middle")
                    .attr("dominant-baseline", "middle")
                    .attr("pointer-events", "none");
            }
            
            // æ·»åŠ Xè½´
            const xAxis = svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${plotHeight})`)
                .call(d3.axisBottom(xScale));
            
            // å¤„ç†Xè½´æ ‡ç­¾
            if (autoRotate.checked && sampleCount > 8) {
                // æ ·æœ¬å¤šæ—¶æ—‹è½¬æ ‡ç­¾
                xAxis.selectAll("text")
                    .attr("transform", "rotate(-45)")
                    .attr("text-anchor", "end")
                    .attr("dx", "-0.5em")
                    .attr("dy", "0.5em")
                    .style("font-size", "10px")
                    .style("font-weight", "normal");
            } else if (wrapText.checked) {
                // æ¢è¡Œæ˜¾ç¤ºé•¿æ ‡ç­¾
                xAxis.selectAll("text")
                    .each(function(d) {
                        const text = d3.select(this);
                        const words = d.split(/(?=[A-Z][a-z])|\s+|_/);
                        if (words.length > 1) {
                            text.text("");
                            words.forEach((word, i) => {
                                text.append("tspan")
                                    .text(word)
                                    .attr("x", 0)
                                    .attr("dy", i === 0 ? "0em" : "1.2em")
                                    .attr("text-anchor", "middle");
                            });
                        }
                    })
                    .style("font-size", "10px")
                    .style("font-weight", "normal");
            } else {
                xAxis.selectAll("text")
                    .style("font-size", "10px")
                    .style("font-weight", "normal");
            }
            
            // æ·»åŠ Xè½´æ ‡ç­¾
            svg.append("text")
                .attr("class", "x-axis-label")
                .attr("text-anchor", "middle")
                .attr("x", plotWidth / 2)
                .attr("y", plotHeight + margin.bottom - 80)
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("æ ·æœ¬ (Samples)");
            
            // æ·»åŠ Yè½´
            svg.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(yScale))
                .selectAll("text")
                .style("font-size", "12px")
                .style("font-style", "italic");
            
            // æ·»åŠ Yè½´æ ‡ç­¾
            svg.append("text")
                .attr("class", "y-axis-label")
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .attr("x", -plotHeight / 2)
                .attr("y", -margin.left + 20)
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("å¾®ç”Ÿç‰© (Microbes)");
            
            // æ·»åŠ æ ‡é¢˜
            svg.append("text")
                .attr("class", "chart-title")
                .attr("text-anchor", "middle")
                .attr("x", plotWidth / 2)
                .attr("y", -40)
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .text(`å¾®ç”Ÿç‰©ä¸°åº¦æ°”æ³¡å›¾ (${logLabel}è½¬æ¢)`);
            
            // æ·»åŠ å‰¯æ ‡é¢˜æ˜¾ç¤ºæ ·æœ¬ä¿¡æ¯
            svg.append("text")
                .attr("class", "chart-subtitle")
                .attr("text-anchor", "middle")
                .attr("x", plotWidth / 2)
                .attr("y", -15)
                .style("font-size", "12px")
                .style("fill", "#666")
                .text(`${microbeCount}ç§å¾®ç”Ÿç‰©ï¼Œ${sampleCount}ä¸ªæ ·æœ¬`);
            
            // æ›´æ–°å›¾ä¾‹
            updateLegend();
            
            showStatus(`å›¾è¡¨ç”ŸæˆæˆåŠŸ! (${sampleCount}æ ·æœ¬ Ã— ${microbeCount}å¾®ç”Ÿç‰©)`, 'success');
        }
        
        // è·å–é¢œè‰²æ’å€¼å™¨
        function getColorInterpolator() {
            const scheme = colorScheme.value;
            
            switch(scheme) {
                case 'blue-gradient':
                    return d3.interpolateBlues;
                
                case 'blue-white':
                    return t => d3.interpolateRgb("white", "blue")(t);
                
                case 'viridis':
                    return d3.interpolateViridis;
                
                case 'plasma':
                    return d3.interpolatePlasma;
                
                case 'red-yellow':
                    return t => d3.interpolateRgb("red", "yellow")(t);
                
                case 'green-gradient':
                    return t => d3.interpolateRgb("white", "green")(t);
                
                case 'inferno':
                    return d3.interpolateInferno;
                
                case 'magma':
                    return d3.interpolateMagma;
                
                default:
                    return d3.interpolateBlues;
            }
        }
        
        // æ›´æ–°å›¾ä¾‹
        function updateLegend() {
            if (!processedData) return;
            
            const logLabel = getLogLabel();
            legendContainer.innerHTML = `<h3>å›¾ä¾‹è¯´æ˜</h3>`;
            
            // åˆ›å»ºæ°”æ³¡å¤§å°å›¾ä¾‹
            const sizeLegend = document.createElement('div');
            sizeLegend.className = 'legend-item';
            
            const sizeMinVal = parseFloat(sizeMin.value);
            const sizeMaxVal = parseFloat(sizeMax.value);
            const midSize = (sizeMinVal + sizeMaxVal) / 2;
            const logMinVal = parseFloat(logMin.value);
            const logMaxVal = parseFloat(logMax.value);
            const midLog = (logMinVal + logMaxVal) / 2;
            
            sizeLegend.innerHTML = `
                <div style="display: flex; align-items: center; margin-right: 30px; margin-bottom: 15px;">
                    <span style="margin-right: 10px; font-weight: bold;">æ°”æ³¡å¤§å°:</span>
                    <div style="display: flex; align-items: center;">
                        <div style="width: ${sizeMinVal}px; height: ${sizeMinVal}px; border-radius: 50%; background-color: #4dabf7; margin-right: 5px; border: 1px solid #339af0;"></div>
                        <span>${logMin.value}</span>
                        <div style="width: ${midSize}px; height: ${midSize}px; border-radius: 50%; background-color: #4dabf7; margin: 0 10px; border: 1px solid #339af0;"></div>
                        <span>${midLog.toFixed(1)}</span>
                        <div style="width: ${sizeMaxVal}px; height: ${sizeMaxVal}px; border-radius: 50%; background-color: #4dabf7; margin-left: 10px; margin-right: 5px; border: 1px solid #339af0;"></div>
                        <span>${logMax.value}</span>
                    </div>
                </div>
            `;
            
            // åˆ›å»ºé¢œè‰²å›¾ä¾‹
            const colorLegend = document.createElement('div');
            colorLegend.className = 'legend-item';
            
            // åˆ›å»ºé¢œè‰²æ¡
            let colorBarHTML = '<div style="display: flex; align-items: center; margin-bottom: 15px;">';
            colorBarHTML += '<span style="margin-right: 10px; font-weight: bold;">æ°”æ³¡é¢œè‰²:</span>';
            colorBarHTML += '<div style="display: flex; align-items: center; height: 30px; background: linear-gradient(to right, ';
            
            // ç”Ÿæˆæ¸å˜é¢œè‰²æ¡
            const colorInterpolator = getColorInterpolator();
            const steps = 10;
            for (let i = 0; i <= steps; i++) {
                const value = i / steps;
                colorBarHTML += `${colorInterpolator(value)} ${i * 10}%`;
                if (i < steps) colorBarHTML += ', ';
            }
            
            colorBarHTML += '); width: 300px; border-radius: 4px; border: 1px solid #dee2e6; margin: 0 10px;"></div>';
            colorBarHTML += `<div style="display: flex; justify-content: space-between; width: 300px; margin-top: 5px; margin-left: 10px;">
                <span>${logMin.value}</span>
                <span>${midLog.toFixed(1)}</span>
                <span>${logMax.value}</span>
            </div>`;
            colorBarHTML += '</div>';
            
            colorLegend.innerHTML = colorBarHTML;
            
            legendContainer.appendChild(sizeLegend);
            legendContainer.appendChild(colorLegend);
            
            // æ·»åŠ è¯´æ˜
            const explanation = document.createElement('div');
            explanation.style.marginTop = '15px';
            explanation.style.fontSize = '0.9rem';
            explanation.style.color = '#6c757d';
            explanation.innerHTML = `
                <p><strong>è¯´æ˜:</strong> æ°”æ³¡å¤§å°å’Œé¢œè‰²éƒ½è¡¨ç¤º${logLabel}(RPM+1)å€¼ã€‚æ•°å€¼è¶Šå¤§ï¼Œæ°”æ³¡è¶Šå¤§ï¼Œé¢œè‰²è¶Šæ·±ã€‚</p>
                <p>é¼ æ ‡æ‚¬åœåœ¨æ°”æ³¡ä¸Šå¯æŸ¥çœ‹åŸå§‹RPMå€¼å’Œå¯¹æ•°è½¬æ¢å€¼ã€‚</p>
                <p>å½“å‰æ•°æ®: ${processedData.microbes.length}ç§å¾®ç”Ÿç‰©ï¼Œ${processedData.samples.length}ä¸ªæ ·æœ¬</p>
            `;
            legendContainer.appendChild(explanation);
        }
        
        // é‡ç½®è®¾ç½®
        function resetSettings() {
            colorScheme.value = 'blue-gradient';
            sizeMin.value = 5;
            sizeMax.value = 30;
            logMin.value = 0;
            logMax.value = 8;
            showValues.checked = true;
            showGrid.checked = true;
            showLogValues.checked = true;
            formatNumbers.checked = true;
            wrapText.checked = true;
            autoRotate.checked = true;
            log10Radio.checked = true;
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            sizeMinValue.textContent = sizeMin.value;
            sizeMaxValue.textContent = sizeMax.value;
            logMinValue.textContent = logMin.value;
            logMaxValue.textContent = logMax.value;
            
            showStatus('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'info');
            
            // é‡æ–°ç”Ÿæˆå›¾è¡¨
            if (processedData) {
                processData(rawData);
                generateChart();
            }
        }
        
        // å¯¼å‡ºä¸ºPNG
        function exportAsPNG() {
            if (!chartSVG) {
                showStatus('è¯·å…ˆç”Ÿæˆå›¾è¡¨', 'info');
                return;
            }
            
            const svgElement = chartContainer.querySelector('svg');
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸
            canvas.width = svgElement.clientWidth;
            canvas.height = svgElement.clientHeight;
            
            const img = new Image();
            const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
            const url = URL.createObjectURL(svgBlob);
            
            img.onload = function() {
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(url);
                
                const dataURL = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'microbial_bubble_plot.png';
                link.href = dataURL;
                link.click();
                showStatus('PNGå›¾ç‰‡å¯¼å‡ºæˆåŠŸ!', 'success');
            };
            
            img.src = url;
        }
        
        // å¯¼å‡ºä¸ºPDF
        function exportAsPDF() {
            if (!chartSVG) {
                showStatus('è¯·å…ˆç”Ÿæˆå›¾è¡¨', 'info');
                return;
            }
            
            showStatus('æ­£åœ¨ç”ŸæˆPDFï¼Œè¯·ç¨å€™...', 'info');
            
            // ç§»é™¤æ‰€æœ‰å·¥å…·æç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            d3.selectAll(".tooltip").remove();
            
            // åˆ›å»ºè¦å¯¼å‡ºçš„å†…å®¹å®¹å™¨
            const exportContainer = document.createElement('div');
            exportContainer.style.position = 'fixed';
            exportContainer.style.left = '-9999px';
            exportContainer.style.top = '0';
            exportContainer.style.width = '1200px';
            exportContainer.style.backgroundColor = 'white';
            exportContainer.style.padding = '20px';
            
            // å¤åˆ¶å›¾è¡¨å®¹å™¨å†…å®¹
            const chartClone = chartContainer.cloneNode(true);
            
            // å¤åˆ¶å›¾ä¾‹å®¹å™¨å†…å®¹
            const legendClone = legendContainer.cloneNode(true);
            
            // æ·»åŠ åˆ°å¯¼å‡ºå®¹å™¨
            exportContainer.appendChild(chartClone);
            exportContainer.appendChild(legendClone);
            
            // æ·»åŠ åˆ°æ–‡æ¡£
            document.body.appendChild(exportContainer);
            
            // ä½¿ç”¨html2canvasè½¬æ¢
            html2canvas(exportContainer, {
                scale: 2, // æé«˜åˆ†è¾¨ç‡
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                // ä»æ–‡æ¡£ä¸­ç§»é™¤ä¸´æ—¶å®¹å™¨
                document.body.removeChild(exportContainer);
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF('landscape', 'mm', 'a4');
                
                // è®¡ç®—å›¾åƒå°ºå¯¸ä»¥é€‚åº”PDFé¡µé¢
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                const imgWidth = pageWidth - 20; // å·¦å³å„ç•™10mmè¾¹è·
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // å¦‚æœå›¾åƒé«˜åº¦è¶…è¿‡é¡µé¢é«˜åº¦ï¼Œè°ƒæ•´å®½åº¦
                let finalImgWidth = imgWidth;
                let finalImgHeight = imgHeight;
                
                if (imgHeight > pageHeight - 20) {
                    finalImgHeight = pageHeight - 20;
                    finalImgWidth = (canvas.width * finalImgHeight) / canvas.height;
                }
                
                // å±…ä¸­å›¾åƒ
                const xOffset = (pageWidth - finalImgWidth) / 2;
                const yOffset = (pageHeight - finalImgHeight) / 2;
                
                pdf.addImage(imgData, 'PNG', xOffset, yOffset, finalImgWidth, finalImgHeight);
                pdf.save('microbial_bubble_plot.pdf');
                
                showStatus('PDFæ–‡æ¡£å¯¼å‡ºæˆåŠŸ!', 'success');
            }).catch(error => {
                console.error('PDFå¯¼å‡ºé”™è¯¯:', error);
                showStatus('PDFå¯¼å‡ºå¤±è´¥: ' + error.message, 'error');
                
                // ç¡®ä¿ç§»é™¤ä¸´æ—¶å®¹å™¨
                if (document.body.contains(exportContainer)) {
                    document.body.removeChild(exportContainer);
                }
            });
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (!processedData) {
                showStatus('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®', 'info');
                return;
            }
            
            // åˆ›å»ºCSVå†…å®¹
            const logLabel = getLogLabel();
            let csvContent = "Microbe," + processedData.samples.join(",") + "\n";
            
            // è·å–å”¯ä¸€çš„å¾®ç”Ÿç‰©
            const uniqueMicrobes = [...new Set(processedData.data.map(d => d.microbe))];
            
            uniqueMicrobes.forEach(microbe => {
                const rowData = [microbe];
                processedData.samples.forEach(sample => {
                    const dataPoint = processedData.data.find(d => d.microbe === microbe && d.sample === sample);
                    // å¯¼å‡ºLogè½¬æ¢å€¼
                    rowData.push(dataPoint.logValue.toFixed(4));
                });
                csvContent += rowData.join(",") + "\n";
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `microbial_data_${logLabel}_transformed.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus(`${logLabel}è½¬æ¢æ•°æ®å¯¼å‡ºæˆåŠŸ!`, 'success');
        }
        
        // å¯¼å‡ºæ•°å€¼è¡¨æ ¼
        function exportTable() {
            if (!processedData || !rawData) {
                showStatus('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®', 'info');
                return;
            }
            
            // åˆ›å»ºCSVå†…å®¹ï¼ˆåŸå§‹RPMå€¼ï¼‰
            let csvContent = "Microbe," + processedData.samples.join(",") + "\n";
            
            // è·å–åŸå§‹æ•°æ®ä¸­çš„è¡Œ
            rawData.forEach(row => {
                const microbe = row[Object.keys(row)[0]];
                const rowData = [microbe];
                
                processedData.samples.forEach(sample => {
                    const value = parseFloat(row[sample]) || 0;
                    rowData.push(value);
                });
                
                csvContent += rowData.join(",") + "\n";
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'microbial_data_original_rpm.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('åŸå§‹RPMæ•°æ®å¯¼å‡ºæˆåŠŸ!', 'success');
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }
        
        // æ¨¡æ€æ¡†åŠŸèƒ½
        const titleClickable = document.getElementById('title-clickable');
        const modal = document.getElementById('manual-modal');
        const closeModal = document.getElementById('close-modal');
        
        // ç‚¹å‡»æ ‡é¢˜æ‰“å¼€æ¨¡æ€æ¡†
        titleClickable.addEventListener('click', () => {
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        });
        
        // ç‚¹å‡»å…³é—­æŒ‰é’®å…³é—­æ¨¡æ€æ¡†
        closeModal.addEventListener('click', () => {
            modal.classList.remove('show');
            document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        });
        
        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && modal.classList.contains('show')) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            showStatus('æ¬¢è¿ä½¿ç”¨å¾®ç”Ÿç‰©æ°”æ³¡å›¾ç”Ÿæˆå™¨ï¼æ”¯æŒä»»æ„æ•°é‡æ ·æœ¬ï¼Œè‡ªåŠ¨è°ƒæ•´å¸ƒå±€ã€‚ç‚¹å‡»æ ‡é¢˜æŸ¥çœ‹ä½¿ç”¨è¯´æ˜ä¹¦ã€‚', 'info');
            
            // è‡ªåŠ¨åŠ è½½ç¤ºä¾‹æ•°æ®
            setTimeout(() => {
                loadSampleData();
            }, 500);
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', () => {
            if (chartSVG && processedData) {
                generateChart();
            }
        });
    </script>
</body>
</html>