# 微生物气泡图生成器

一个专业的微生物丰度可视化工具，支持任意数量样本，自动调整布局，生成美观的气泡热图。

## 功能特点

- 📊 **智能可视化**：自动生成微生物丰度气泡图，气泡大小和颜色表示对数转换后的数值
- 📁 **灵活数据输入**：支持CSV/TSV格式，支持任意数量的样本列
- 🎨 **多种颜色方案**：8种预设颜色方案（蓝色渐变、Viridis、Plasma、Inferno等）
- 🔢 **对数转换**：支持Log₁₀(RPM+1)和Log₂(RPM+1)两种转换方式
- 📐 **自适应布局**：根据样本和微生物数量自动调整图表尺寸和气泡大小
- 💾 **多格式导出**：支持导出PNG图片、PDF文档、处理后的数据CSV和原始数据表格
- 🖱️ **交互式体验**：鼠标悬停显示详细信息，支持多种显示选项

## 快速开始

### 在线使用

1. 访问 [GitHub Pages](https://bupoo123.github.io/microbial-bubble-plot/) 或直接打开 `index.html` 文件
2. 页面会自动加载示例数据并生成图表
3. 点击"加载示例数据（实际格式）"按钮可以重新加载示例数据

### 下载示例数据

📥 **下载示例CSV文件**：[data-气泡热图数据.csv](data-气泡热图数据.csv)

此文件包含实际的数据格式示例，包含13个样本和5种微生物，可以帮助您了解正确的数据格式。

## 使用方法

### 1. 数据准备

准备CSV或TSV格式的数据文件，格式要求：

- **第一列**：微生物/物种名称（文本）
- **后续列**：样本名称（列名），数值为RPM值
- 支持任意数量的样本列
- 支持小数和0值

**示例数据格式：**

```csv
Species,1: 0: 0: 0: 0,0: 1: 0: 0: 0,0: 0: 1: 0: 0,0: 0: 0: 1: 0,0: 0: 0: 0: 1,1: 3: 0: 0: 0,3: 1: 0: 0: 0,1: 0: 0: 3: 0,0: 1: 0: 3: 0,0: 0: 1: 3: 0,1: 0: 0: 0: 3,0: 1: 0: 0: 3,0: 0: 1: 0: 3
A. fumigatus,109753.74,0,0,0,0,59925.19,82644.69,68440.4,0.19,0.74,132726.97,0,2.28
A. flavus,1.27,42045.49,0,0,0,41218.61,32235.41,1.14,31946.04,0,0,48788.94,1.68
A. terreus,0,0,26640.72,0,0,0,0,0,0.19,12882.18,0,0,18011.76
A. niger,0,0.67,0,2407.22,0,0,0,4167.59,3211.57,4300.01,0,0,0
A. nidulans,0,0,0,0,4588.63,0,0,0,0,0.74,3559.51,3621.15,6223.52
```

> 💡 **提示**：您可以下载上面的示例CSV文件作为参考格式。

### 2. 上传数据

有三种方式加载数据：

1. **拖放上传**：直接将CSV/TSV文件拖放到上传区域
2. **点击选择**：点击"选择文件"按钮，从文件浏览器中选择文件
3. **示例数据**：点击"加载示例数据（实际格式）"按钮，使用内置示例数据（自动加载）

### 3. 设置参数

#### 对数转换设置
- **Log₁₀(RPM+1) 转换**：适用于一般微生物数据分析（默认）
- **Log₂(RPM+1) 转换**：适用于基因表达数据分析

#### 可视化设置
- **颜色方案**：选择8种预设颜色方案之一
- **气泡大小范围**：调整气泡的最小和最大尺寸（像素）
- **对数转换值范围**：设置用于颜色和大小映射的数值范围
- **显示选项**：
  - 显示格子边框
  - 在气泡中显示数值
  - 在悬停提示中显示对数值
  - 格式化数值（千位分隔符）
  - 换行长样本名称
  - 自动旋转样本标签

#### 自动调整功能
- **自动调整气泡大小**：根据样本和微生物数量自动调整气泡大小
- **自动调整数值范围**：根据数据范围自动调整对数转换值范围
- **全部自动调整**：一键自动调整所有参数

### 4. 生成图表

点击"生成热图"按钮，系统将自动生成气泡图。图表会根据数据量自动调整尺寸和布局。

### 5. 导出结果

支持多种导出格式：

- **导出PNG图片**：导出高分辨率PNG格式图片
- **导出PDF文档**：导出包含图表和图例的PDF文档
- **导出处理后的数据**：导出对数转换后的数据（CSV格式）
- **导出数值表格**：导出原始RPM值数据（CSV格式）

## 技术说明

### 数据转换公式

- **Log₁₀转换**：`Log₁₀(RPM + 1)`
- **Log₂转换**：`Log₂(RPM + 1)`

### 气泡映射规则

- **气泡大小**：根据对数转换值在设定范围内线性映射到气泡半径
- **气泡颜色**：根据对数转换值在设定范围内映射到颜色方案

### 自适应规则

- **气泡大小**：根据样本数量和微生物数量自动调整
  - ≤5个样本：5-35像素
  - 6-10个样本：4-30像素
  - 11-20个样本：3-25像素
  - >20个样本：2-20像素
- **图表尺寸**：根据样本和微生物数量动态计算，最小800×500像素，最大2000×1500像素

## 浏览器兼容性

- Chrome/Edge（推荐）
- Firefox
- Safari
- 其他现代浏览器

## 技术栈

- **D3.js**：数据可视化
- **PapaParse**：CSV/TSV文件解析
- **jsPDF**：PDF导出
- **html2canvas**：图片导出

## 数据隐私

**重要提示**：所有数据处理都在浏览器本地完成，数据不会上传到任何服务器，确保数据安全。

## 版本信息

- **当前版本**：v1.6.2
- **更新日期**：2025年

## 使用技巧

1. **大数据集**：对于大量样本（>20个），建议使用"自动调整"功能优化显示效果
2. **长名称处理**：如果样本名称较长，启用"换行长样本名称"或"自动旋转样本标签"
3. **颜色选择**：根据数据特点选择合适的颜色方案，Viridis和Plasma适合科学出版物
4. **导出设置**：导出PDF时，图表会自动调整以适应A4页面

## 常见问题

**Q: 为什么有些气泡显示为0？**  
A: RPM值为0的数据点不会显示气泡，这是正常现象。

**Q: 如何调整气泡大小？**  
A: 使用"气泡大小范围"滑块，或点击"自动调整"按钮让系统自动优化。

**Q: 支持哪些文件格式？**  
A: 支持CSV（逗号分隔）和TSV（制表符分隔）格式。

**Q: 可以处理多少样本？**  
A: 理论上支持任意数量的样本，系统会自动调整布局以适应数据量。

**Q: 导出的图片分辨率如何？**  
A: PNG导出使用SVG转换，PDF导出使用2倍分辨率，确保高质量输出。

## 许可证

本工具为开源工具，可自由使用和修改。

## 反馈与支持

如有问题或建议，欢迎通过GitHub Issues反馈。

---

© 2025 微生物气泡图生成器 | 基于D3.js和JavaScript构建

